# 指示ファイル（project/role）ベストプラクティス適合レビュー

## 概要
`project.instructions.md` と `role.instructions.md` を確認し、Minecraft Fabric（Stonecutter/Gradle/Loom）開発の実務・保守運用の観点で、指示内容が概ねベストプラクティスに沿っているかを点検した。

結論として、**大枠は妥当で再現性・保守性に寄与**している。一方で、**「出力ルール（unified diff）」の運用はツール前提と齟齬が出やすい**点、また **Stonecutter の分岐・依存バージョン固定の方針が“いつ/どこで更新するか”の運用規約として不足**している点が改善余地。

## 詳細

### 良い点（ベストプラクティスに沿っている）
- **ターゲット環境の明示**（MC/JDK/Loom/Yarn/Fabric API）：
  - バージョン・依存関係のスコープが明確で、再現性が高い。
- **Client mod としての境界**（client パッケージ、client/server 参照混在禁止）：
  - 誤ったサイド参照の混入を抑制できる。
- **依存関係の最小化**（Fabric API 必要最小限）：
  - Mod の互換性・保守性に有利。
- **Mixin 方針（最小限 / Inject/Redirect 優先 / Overwrite 乱用禁止）**：
  - 将来のMC更新・他Mod競合に強い。
- **Tick 軽量化、非同期Worldアクセス禁止**：
  - クライアントQoLで重要なパフォーマンス・安全性の原則。
- **Gradle properties の命名規約（`deps.` 統一）**：
  - マルチバージョン（Stonecutter）での差分管理に適している。
- **Loggerの使用（System.out禁止）**：
  - 本番運用・ログ解析の観点で妥当。
- **「曖昧なら質問」**：
  - 仕様逸脱を防ぐコミュニケーション上のベストプラクティス。

### 気になる点（曖昧さ・矛盾しうる点）
- **「既存コード変更はunified diff形式で出力」**:
  - チャット出力方針としては有用だが、エディタ統合の自動編集フローでは**常にdiffで出す運用が難しい**（＝実務上、手段が制約になりやすい）。
  - 将来的に「diffはレポートに付録として載せる」等の運用に寄せると摩擦が減る。
- **Stonecutter 分岐を `Stonecutter.getCurrent()` に集約**:
  - 原則として良いが、
    - *どこまでを分岐対象にするか*（API差分/クラス名差分/挙動差分）、
    - *分岐が増えた場合の負債管理*（共通層の抽出、クラス分割）
    のルールがないため、規模拡大時にスパゲッティ化しうる。
- **Fabric Loader を全バージョンで 0.18.2 固定**:
  - 互換性検証の簡略化としては理解できるが、
  - セキュリティ/不具合修正の取り込み（更新頻度・互換テスト）方針が未定義だと**長期的にはリスク**。
- **「マジックナンバー禁止」**:
  - 良い原則だが、ゲームUI/入力/アニメーション等では定数が増えるため、
  - `Constants`/`Config`/`Tuning` 等に寄せる、あるいは「設定値か内部定数か」の分類ルールがあると運用しやすい。
- **「Java 17/21」環境記載は良いが、ソース/ターゲット互換の運用が未記載**:
  - 例：共通コードで使用可能な言語機能、バージョン別ソースセットの扱い、など。

### 改善提案（低リスクで効く）
- **出力ルールの現実的運用**:
  - 「unified diffは *必要時*（レビュー/相談/承認）に提示し、通常はIDE編集・自動適用を基本」と明文化すると、運用の矛盾が減る。
- **Stonecutter分岐のガードレール**:
  - 分岐は「APIシグネチャ差分のみ」等の最小範囲に限定し、
  - 差分が一定量を超えたら「バージョン別クラスへ分割」などの閾値ルールを追加。
- **依存更新ポリシー**（Loader/API/Yarn）:
  - 「LTS/安定版追随」「月次/リリース毎」など更新頻度と、更新時に走らせる確認項目（起動/基本操作/回帰テスト）を簡単に定義。
- **client/server境界の補強**:
  - `@Environment(EnvType.CLIENT)` の運用方針、`client` パッケージ以外にクライアント専用を置かないルールの明文化など。

## 結論
- 指示内容は全体として **Fabric製クライアントQoL Mod のベストプラクティスに概ね準拠**している。
- 改善余地は主に **運用・スケール時のルール不足**（diff出力の扱い、Stonecutter分岐の負債制御、依存更新ポリシー）。

## ネクストアクション
1. `project.instructions.md` に「diff出力の適用条件」と「Stonecutter分岐の閾値/分割方針」を1〜2段落で追記する。
2. Loader/API/Yarnの更新ポリシー（頻度＋最低限の動作確認項目）を追記する。

---
ステータス: **レビュー完了（変更は未適用）**

